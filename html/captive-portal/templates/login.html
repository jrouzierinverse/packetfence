[% title = i18n("Login") %]
[% INCLUDE header.html 
    body_attributes = 'onload="$(\'#username\').focus();"';
%]

<script type="text/javascript">
$(document).ready(function() {

  // Don't propagate mouse clicks on disabled buttons and links
  $('.btn').on('click', function(event) {
    if ($(this).hasClass('disabled')) {
      event.stopPropagation();
      return false;
    }
  });

  var on_change = function() {
     var accepted = false;
     $("input[type='checkbox']").each(function() {
        var name = this.name;
        accepted = false;
        $("input[name='" + name + "']").each(function() {
            if (this.checked) {
                accepted = true;
                return false;
            }
        });
        return accepted;
     });
     $('.btn').each(function() {
        if (accepted)
          $(this).removeClass('disabled');
        else
          $(this).addClass('disabled');
      });
  };
  // Toggle the disable state of the buttons and links when the user
  // accepts or refuses the AUP checkboxes
  $("input[type='checkbox']").each(function() {
    $(this).on('change', on_change);
    });
});
</script>

        [%# Welcome text %]
        <div id="about">
          <img src="/content/images/lock.png" alt="You are not authorized" />
          <p>[% i18n("register: all systems must be registered") %]</p>
          <p>[% i18n("register: to complete") %]</p>
          <hr/>
        </div>

        [%# Error %]
        [% IF txt_auth_error.defined %]<div class="error"><p>[% txt_auth_error %]</p></div>[% END %]
        [% IF txt_validation_error.defined %]
        <div class="error"><p>[% txt_validation_error %]</p></div>
        [% END %]

        <form name="login" method="post" action="/authenticate">
          <input type="hidden" name="destination_url" value="[% destination_url %]" />

          [%# AUP %]
          <div class="input">
            <div>[% i18n("Acceptable Use Policy") %]</div>
            <div id="aup" class="notmobile">
              [% INCLUDE aup_text.html %]
            </div>
            [%# The space below is intententionnal %]
            <div class="notmobile"><label><input name="aup_signed" type="checkbox" /> [% i18n("I accept the terms") %]</label></div>
            <div class="mobile"><input name="aup_signed" type="checkbox" />[% i18n("I have read and accept the terms") %]</div>

            <div class="notmobile"><label><input name="custom_field_1" type="checkbox" /> [% i18n("Use an operating system that is supported by a reputable vendor (Windows, Mac OS, Linux, Android, iOS etc.)") %]</label></div>
            <div class="mobile"><label><input name="custom_field_1" type="checkbox" /> [% i18n("Use an operating system that is supported by a reputable vendor (Windows, Mac OS, Linux, Android, iOS etc.)") %]</label></div>

            <div class="notmobile"><label><input name="custom_field_2" type="checkbox" /> [% i18n("Choose a strong password that is required at startup.") %]</label></div>
            <div class="mobile"><label><input name="custom_field_2" type="checkbox" /> [% i18n("Choose a strong password that is required at startup.") %]</label></div>

            <div class="notmobile"><label><input name="custom_field_3" type="checkbox" /> [% i18n("Configure your system to received updates automatically.") %]</label></div>
            <div class="mobile"><label><input name="custom_field_3" type="checkbox" /> [% i18n("Configure your system to received updates automatically.") %]</label></div>

            <div class="notmobile"><label><input name="custom_field_4" type="checkbox" /> [% i18n("Install a reputable Anti-Malware package, configured to scan in real-time.") %]</label></div>
            <div class="mobile"><label><input name="custom_field_4" type="checkbox" /> [% i18n("Install a reputable Anti-Malware package, configured to scan in real-time.") %]</label></div>

            <div class="notmobile"><label><input name="custom_field_5" type="checkbox" /> [% i18n("Install a reputable firewall and configure to block all unsolicited incoming connections.") %]</label></div>
            <div class="mobile"><label><input name="custom_field_5" type="checkbox" /> [% i18n("Install a reputable firewall and configure to block all unsolicited incoming connections.") %]</label></div>
          </div>

          [%# User / Pass %]
          [% UNLESS no_username %]
          <div class="input">
            <span>[% IF null_source %][% i18n("Email") %] [% ELSE %] [% i18n("Username") %][% END %]</span>
	    <input class="field" name="username" id="username" type="text" autocorrect="off" autocapitalize="off" value="[% username %]" />
          </div>
          [% END %]
          [% UNLESS null_source || no_password %]
          <div class="input">
            <span>[% i18n("Password") %]</span><input class="field" name="password" type="password" />
          </div>

          [% END %]
          [% FOREACH field IN mandatory_fields %]
          [% NEXT IF field.match("custom_field_[1-5]") %]
          <div class="input">
            <span>[% i18n("$field") %]</span>
            <input class="field" name="[% field %]" type="text" value="[% c.stash.field | html %]" /><br/>
          </div>
          [% END %]

          [%# submit %]
          <div class="input">
            <input type="submit" class="btn disabled" name="submit" value="[% i18n("Login") %]" />
          </div>

          [% IF oauth2_google || oauth2_facebook || oauth2_github || oauth2_linkedin || oauth2_win_live || oauth2_twitter %]
          <div class="input">
            [% IF oauth2_google -%]
            <div class="separator"><div class="or_separator">[% i18n("or") %]</div></div>
            <a class="btn disabled" href="/oauth2/auth?provider=google">[% i18n('Login with Google account') %] <img src="/content/images/google.icon.png"></a>
            [% END -%]
            [% IF oauth2_facebook -%]
            <div class="separator"><div class="or_separator">[% i18n("or") %]</div></div>
            <a class="btn disabled" href="/oauth2/auth?provider=facebook">[% i18n('Login with Facebook account') %] <img src="/content/images/facebook.icon.png"></a>
            [% END %]
            [% IF oauth2_github -%]
            <div class="separator"><div class="or_separator">[% i18n("or") %]</div></div>
            <a class="btn disabled" href="/oauth2/auth?provider=github">[% i18n('Login with GitHub account') %] <img src="/content/images/github.icon.png"></a>
            [% END %]
            [% IF oauth2_linkedin -%]
            <div class="separator"><div class="or_separator">[% i18n("or") %]</div></div>
            <a class="btn disabled" href="/oauth2/auth?provider=linkedin">[% i18n('Login with LinkedIn account') %] <img src="/content/images/linkedin.icon.png"></a>
            [% END %]
            [% IF oauth2_win_live -%]
            <div class="separator"><div class="or_separator">[% i18n("or") %]</div></div>
            <a class="btn disabled" href="/oauth2/auth?provider=windowslive">[% i18n('Login with Windows Live account') %] <img src="/content/images/windowslive.icon.png"></a>
            [% END %]         
            [% IF oauth2_twitter -%]
            <div class="separator"><div class="or_separator">[% i18n("or") %]</div></div>
            <a class="btn disabled" href="/oauth2/auth?provider=twitter">[% i18n('Login with Twitter account') %] <img src="/content/images/twitter.icon.png"></a>
            [% END %]         
          </div>
          [% END %]

            [% IF guest_allowed && !null_source -%]
          <div class="input">
            <div class="separator"><div class="or_separator">or</div></div>
              <a href="[% URL_SIGNUP %]?destination_url=[% destination_url %]">[% i18n("Sign up") %]</a>
          </div>
            [% END -%]

            [% IF billing -%]
              <div class="input">
                <div class="separator"><div class="or_separator">or</div></div>
                  <a href="[% URL_BILLING %]?destination_url=[% destination_url %]">[% i18n("Pay for your access") %]</a>
              </div>
            [% END %]         
        </form>

[% INCLUDE footer.html %]
